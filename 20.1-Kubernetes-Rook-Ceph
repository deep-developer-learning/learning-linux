#################################################
# Add label on nodes for rook
kubectl label node server1 rook.io/cluster=ceph
kubectl label node server2 rook.io/cluster=ceph
kubectl label node server3 rook.io/cluster=ceph

#################################################
# Install Rook
helm repo add rook-release https://charts.rook.io/release
helm repo update
helm install rook-ceph rook-release/rook-ceph --namespace rook-ceph --create-namespace

#################################################
# Create CephCluster instance
cat > ceph-cluster.yaml << EOF
apiVersion: ceph.rook.io/v1
kind: CephCluster
metadata:
  name: my-ceph
  namespace: rook-ceph
spec:
  cephVersion:
    image: quay.io/ceph/ceph:v18.2.0
  dataDirHostPath: /var/lib/rook
  mon:
    count: 3
  storage:
    useAllNodes: true
    useAllDevices: true
    config:
      osdsPerDevice: "1"
EOF


# Apply yaml file
kubectl apply -f ceph-cluster.yaml

#################################################
